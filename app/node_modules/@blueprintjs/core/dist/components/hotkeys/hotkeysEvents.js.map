{"version":3,"sources":["../src/components/hotkeys/hotkeysEvents.ts"],"names":[],"mappings":"AAAA;;;;;GAKG;;AAEH,+BAA0D;AAC1D,4CAAgD;AAEhD,mCAAgD;AAChD,+CAAqF;AAErF,iDAA4E;AAE5E,IAAM,eAAe,GAAG,GAAG,CAAC;AAE5B,IAAY,WAGX;AAHD,WAAY,WAAW;IACnB,+CAAK,CAAA;IACL,iDAAM,CAAA;AACV,CAAC,EAHW,WAAW,GAAX,mBAAW,KAAX,mBAAW,QAGtB;AAOD;IAGI,uBAA2B,KAAkB;QAA7C,iBACC;QAD0B,UAAK,GAAL,KAAK,CAAa;QAFrC,YAAO,GAAG,EAAqB,CAAC;QA0BjC,kBAAa,GAAG,UAAC,CAAgB;YACpC,EAAE,CAAC,CAAC,KAAI,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,sCAAsB,EAAE,CAAC,CAAC,CAAC;gBAClD,MAAM,CAAC;YACX,CAAC;YAED,IAAM,KAAK,GAAG,0BAAW,CAAC,CAAC,CAAC,CAAC;YAE7B,EAAE,CAAC,CAAC,2BAAY,CAAC,4BAAa,CAAC,eAAe,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;gBACtD,iCAAiB,CAAC,KAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAC,MAAM,IAAK,OAAA,MAAM,CAAC,KAAK,EAAZ,CAAY,CAAC,CAAC,CAAC;gBAC9D,MAAM,CAAC;YACX,CAAC;YAED,GAAG,CAAC,CAAiB,UAAY,EAAZ,KAAA,KAAI,CAAC,OAAO,EAAZ,cAAY,EAAZ,IAAY;gBAA5B,IAAM,MAAM,SAAA;gBACb,EAAE,CAAC,CAAC,2BAAY,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;oBACpC,kBAAU,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;gBAC1C,CAAC;aACJ;QACL,CAAC,CAAA;QAEM,gBAAW,GAAG,UAAC,CAAgB;YAClC,EAAE,CAAC,CAAC,KAAI,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,sCAAsB,EAAE,CAAC,CAAC,CAAC;gBAClD,MAAM,CAAC;YACX,CAAC;YAED,IAAM,KAAK,GAAG,0BAAW,CAAC,CAAC,CAAC,CAAC;YAC7B,GAAG,CAAC,CAAiB,UAAY,EAAZ,KAAA,KAAI,CAAC,OAAO,EAAZ,cAAY,EAAZ,IAAY;gBAA5B,IAAM,MAAM,SAAA;gBACb,EAAE,CAAC,CAAC,2BAAY,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;oBACpC,kBAAU,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;gBACxC,CAAC;aACJ;QACL,CAAC,CAAA;IArDD,CAAC;IAEM,6BAAK,GAAZ;QACI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;IAC/B,CAAC;IAEM,6BAAK,GAAZ;QACI,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;IACtB,CAAC;IAEM,kCAAU,GAAjB,UAAkB,KAAgD;QAAlE,iBAWC;QAVG,IAAM,OAAO,GAAG,EAAqB,CAAC;QACtC,gBAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,EAAE,UAAC,KAAwB;YACtD,EAAE,CAAC,CAAC,eAAM,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,KAAI,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBACxD,OAAO,CAAC,IAAI,CAAC;oBACT,KAAK,EAAE,4BAAa,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC;oBACvC,KAAK,EAAE,KAAK,CAAC,KAAK;iBACrB,CAAC,CAAC;YACP,CAAC;QACL,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;IAC3B,CAAC;IAkCO,+BAAO,GAAf,UAAgB,KAAmB;QAC/B,MAAM,CAAC,CAAC,KAAK,CAAC,MAAM,GAAG,WAAW,CAAC,MAAM,GAAG,WAAW,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC;IAClF,CAAC;IAEO,mCAAW,GAAnB,UAAoB,CAAgB;QAChC,IAAM,IAAI,GAAG,CAAC,CAAC,MAAqB,CAAC;QACrC,oEAAoE;QACpE,0BAA0B;QAC1B,EAAE,CAAC,CAAC,IAAI,IAAI,IAAI,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,CAAC,CAAC;YACvC,MAAM,CAAC,KAAK,CAAC;QACjB,CAAC;QAED,IAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,yCAAyC,CAAC,CAAC;QAEzE,EAAE,CAAC,CAAC,QAAQ,IAAI,IAAI,CAAC,CAAC,CAAC;YACnB,MAAM,CAAC,KAAK,CAAC;QACjB,CAAC;QAED,4EAA4E;QAC5E,EAAE,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,WAAW,EAAE,KAAK,OAAO,CAAC,CAAC,CAAC;YAC7C,IAAM,SAAS,GAAI,QAA6B,CAAC,IAAI,CAAC;YACtD,EAAE,CAAC,CAAC,SAAS,KAAK,UAAU,IAAI,SAAS,KAAK,OAAO,CAAC,CAAC,CAAC;gBACpD,MAAM,CAAC,KAAK,CAAC;YACjB,CAAC;QACL,CAAC;QAED,qDAAqD;QACrD,EAAE,CAAC,CAAE,QAA6B,CAAC,QAAQ,CAAC,CAAC,CAAC;YAC1C,MAAM,CAAC,KAAK,CAAC;QACjB,CAAC;QAED,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IACL,oBAAC;AAAD,CA5FA,AA4FC,IAAA;AA5FY,sCAAa","file":"components/hotkeys/hotkeysEvents.js","sourcesContent":["/*\n * Copyright 2016 Palantir Technologies, Inc. All rights reserved.\n * Licensed under the BSD-3 License as modified (the “License”); you may obtain a copy\n * of the license at https://github.com/palantir/blueprint/blob/master/LICENSE\n * and https://github.com/palantir/blueprint/blob/master/PATENTS\n */\n\nimport { Children, ReactElement, ReactNode } from \"react\";\nimport { safeInvoke } from \"../../common/utils\";\n\nimport { Hotkey, IHotkeyProps } from \"./hotkey\";\nimport { comboMatches, getKeyCombo, IKeyCombo, parseKeyCombo } from \"./hotkeyParser\";\nimport { IHotkeysProps } from \"./hotkeys\";\nimport { isHotkeysDialogShowing, showHotkeysDialog } from \"./hotkeysDialog\";\n\nconst SHOW_DIALOG_KEY = \"?\";\n\nexport enum HotkeyScope {\n    LOCAL,\n    GLOBAL,\n}\n\nexport interface IHotkeyAction {\n    combo: IKeyCombo;\n    props: IHotkeyProps;\n}\n\nexport class HotkeysEvents {\n    private actions = [] as IHotkeyAction[];\n\n    public constructor(private scope: HotkeyScope) {\n    }\n\n    public count() {\n        return this.actions.length;\n    }\n\n    public clear() {\n        this.actions = [];\n    }\n\n    public setHotkeys(props: IHotkeysProps & { children: ReactNode[] }) {\n        const actions = [] as IHotkeyAction[];\n        Children.forEach(props.children, (child: ReactElement<any>) => {\n            if (Hotkey.isInstance(child) && this.isScope(child.props)) {\n                actions.push({\n                    combo: parseKeyCombo(child.props.combo),\n                    props: child.props,\n                });\n            }\n        });\n        this.actions = actions;\n    }\n\n    public handleKeyDown = (e: KeyboardEvent) => {\n        if (this.isTextInput(e) || isHotkeysDialogShowing()) {\n            return;\n        }\n\n        const combo = getKeyCombo(e);\n\n        if (comboMatches(parseKeyCombo(SHOW_DIALOG_KEY), combo)) {\n            showHotkeysDialog(this.actions.map((action) => action.props));\n            return;\n        }\n\n        for (const action of this.actions) {\n            if (comboMatches(action.combo, combo)) {\n                safeInvoke(action.props.onKeyDown, e);\n            }\n        }\n    }\n\n    public handleKeyUp = (e: KeyboardEvent) => {\n        if (this.isTextInput(e) || isHotkeysDialogShowing()) {\n            return;\n        }\n\n        const combo = getKeyCombo(e);\n        for (const action of this.actions) {\n            if (comboMatches(action.combo, combo)) {\n                safeInvoke(action.props.onKeyUp, e);\n            }\n        }\n    }\n\n    private isScope(props: IHotkeyProps) {\n        return (props.global ? HotkeyScope.GLOBAL : HotkeyScope.LOCAL) === this.scope;\n    }\n\n    private isTextInput(e: KeyboardEvent) {\n        const elem = e.target as HTMLElement;\n        // we check these cases for unit testing, but this should not happen\n        // during normal operation\n        if (elem == null || elem.closest == null) {\n            return false;\n        }\n\n        const editable = elem.closest(\"input, textarea, [contenteditable=true]\");\n\n        if (editable == null) {\n            return false;\n        }\n\n        // don't let checkboxes, switches, and radio buttons prevent hotkey behavior\n        if (editable.tagName.toLowerCase() === \"input\") {\n            const inputType = (editable as HTMLInputElement).type;\n            if (inputType === \"checkbox\" || inputType === \"radio\") {\n                return false;\n            }\n        }\n\n        // don't let read-only fields prevent hotkey behavior\n        if ((editable as HTMLInputElement).readOnly) {\n            return false;\n        }\n\n        return true;\n    }\n}\n"]}